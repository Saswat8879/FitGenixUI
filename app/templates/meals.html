{# app/templates/meals.html #}
{% extends "layout.html" %}

{% block title %}Meals{% endblock %}

{% block content %}
<div class="container">
  <h1 class="card-title mb-6">Meals — {{ today.strftime('%Y-%m-%d') }}</h1>

  <div class="grid grid-cols-4 gap-4 mb-6">
    <div class="card">
      <div class="card-content text-center">
        <div class="text-sm text-muted mb-2">Target</div>
        <div class="text-2xl font-bold">{{ target if target is not none else '—' }}</div>
      </div>
    </div>
    <div class="card">
      <div class="card-content text-center">
        <div class="text-sm text-muted mb-2">Consumed</div>
        <div class="text-2xl font-bold">{{ consumed if consumed is not none else 0 }}</div>
      </div>
    </div>
    <div class="card">
      <div class="card-content text-center">
        <div class="text-sm text-muted mb-2">Remaining</div>
        <div class="text-2xl font-bold">{{ remaining if remaining is not none else '—' }}</div>
      </div>
    </div>
    <div class="card">
      <div class="card-content text-center">
        <div class="text-sm text-muted mb-2">Excess</div>
        <div class="text-2xl font-bold">{{ excess if excess is not none else 0 }}</div>
      </div>
    </div>
  </div>

  <div class="card mb-6">
    <div class="card-header">
      <h2 class="card-title">Add Meal</h2>
      <p class="card-description">Calories are automatically looked up (CalorieNinjas) if available.</p>
    </div>
    <div class="card-content">
      <form action="{{ url_for('meals.add_meal') }}" method="post" class="grid grid-cols-4 gap-4">
        <input class="form-control" type="text" name="name" placeholder="e.g. 1 apple, 200g chicken" required style="grid-column: span 2;">
        <input class="form-control" type="number" step="0.1" name="calories" placeholder="calories (optional)">
        <button class="btn btn-primary" type="submit">Add</button>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Today's meals</h2>
    </div>
    <div class="card-content">
      {% if meals %}
        <div class="table-wrapper">
          <table class="table">
            <thead class="table-header">
              <tr>
                <th>Time</th>
                <th>Name</th>
                <th>Calories</th>
              </tr>
            </thead>
            <tbody>
              {% for m in meals %}
                <tr class="table-row">
                  <td class="table-cell">
                    {% if m.time %}
                      {{ m.time.strftime("%H:%M") }}
                    {% elif m.logged_at %}
                      {{ m.logged_at.strftime("%H:%M") }}
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td class="table-cell">{{ m.name }}</td>
                  <td class="table-cell">{{ (m.calories or m.kcal) | int }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted text-center">No meals logged today.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}